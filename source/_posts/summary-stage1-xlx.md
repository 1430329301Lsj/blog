---
title: xlx-2024第一二阶段总结报告
date: 2024-04-26 17:53:16
tags:
---

## 一阶段总结

### 前言
其实很久之前就一直想完整的过一遍rcore，奈何时间总是不允许。这次正好在写毕业论文，就抽出一点时间。

### 过程
第一阶段的rustlings其实几年前就做过一次。没有太多可讲的点，但是训练营似乎增加了几道之前没接触过的数据结构题，应该属于原创内容，还是比较有趣的。几种数据结构都是比较经典的，但是由于rust语言的特性，诸如链表或是二叉树结构的节点中，子节点都使用了Box智能指针来保存。在一般的传统语言，诸如c/c++，我们会直接保存该指向结构的指针，而rust中，裸指针的操作是不安全的，所以题目中使用Box将节点结构包裹起来。
这里有一个经典入门问题，为何不在结构中直接保存同样结构的子节点而是使用指针呢？原因在于循环嵌套的结构体会导致编译器无法确定结构体的大小，而指针（当然也包括Box）是固定大小的，从而使得在循环嵌套的情况下，能让编译器在编译期确定结构体的大小。
对于指针的操作，习题中出于简单考虑，直接在unsafe中使用裸指针操作解决了，实际上，通过使用其它智能指针，合理的设计结构体，是能够完全避免使用unsafe的，这里就不展开说了。希望能够顺利完成所有训练。

## 二阶段总结
二阶段的内容前面和blog-os基本没什么大的区别，因为以前和洛佳一起翻译过一次，没什么太多能讲的。主要是文件系统这一块，之前没有太多了解。文件系统的结构从某种程度上来说和内存的分页机制很像。另外需要注意的是软硬链接的区别。
- 硬链接(hard link) ln
	- UNIX文件系统提供了一种将不同文件链接至同一个文件的机制，我们称这种机制为链接。它可以使得单个程序对同一文件使用不同的名字。这样的好处是文件系统只存在一个文件的副本。系统简单地通过在目录中建立一个新的登记项来实现这种连接。该登记项具有一个新的文件名和要连接文件的inode号(inode与原文件相同)。不论一个文件有多少硬链接，在磁盘上只有一个描述它的inode，只要该文件的链接数不为0，该文件就保持存在。硬链接不能对目录建立硬链接！
	- 硬连接是直接建立在节点表上的（inode），建立硬连接指向一个文件的时候，会更新节点表上面的计数值。举个例子，一个文件被连接了两次（硬连接），这个文件的计数值是3，而无论通过3个文件名中的任何一个访问，效果都是完全一样的，但是如果删除其中任意一个，都只是把计数值减1，不会删除实际的内容的，（任何存在的文件本身就算是一个硬连接）只有计数值变成0也就是没有任何硬连接指向的时候才会真实的删除内容。
- 软链接(symbolic link) ln-s
	- 我们把符号链接称为软链接，它是指向另一个文件的特殊文件，这种文件的数据部分仅包含它所要链接文件的路径名。软链接是为了克服硬链接的不足而引入的，软链接不直接使用inode号作为文件指针，而是使用文件路径名作为指针（软链接：文件名 + 数据部分-->目标文件的路径名）。软件有自己的inode，并在磁盘上有一小片空间存放路径名。因此，软链接能够跨文件系统，也可以和目录链接！其二，软链接可以对一个不存在的文件名进行链接，但直到这个名字对应的文件被创建后，才能打开其链接。
关于最后一章的死锁检测，由于具体的算法已经给出，实际上只要在每次上锁解锁的时候进行一些处理即可。

总的来说，rcore的文档可以说非常丰富，可以学到很多，但就实验来说，其实和文档脱节比较厉害。同时如果只是为了完成实验实际上并不需要对rcore了解太多，等之后有空看看mit6.s081是怎么做的，是否在实验编排上有所区别。

