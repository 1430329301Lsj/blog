---
title: Report of OS Tutorial
date: 2020-07-26 20:07:40
categories:
	- <report>
tags:
	- author:<SKTT1Ryze>
	- repo:<https://github.com/SKTT1Ryze/OS_Tutorial_Summer_of_Code>
	- <Summer of Code>
---

## 前言
2020年6月30日，在年级群看到了一位同学发的 OS Tutorial Summer of Code 链接，拍拍脑袋，决定利用这个暑假参加这次活动。  
原因要追溯到上个学期，也就是大二上学期，的末尾，第一次在我的笔记本电脑上装了 Linux 双系统，从此就喜欢上了 Linux，一发不可收拾，这种兴趣逐渐使我萌生了动手写 OS 的想法，但一直以来都没有一个完整的知识体系和现成框架，这让我无从下手。  
从那天开始，这个活动带我进入了一个新的世界，一个关于 Rust 语言，RISC-V体系结构，和新时代操作系统的新世界。  
## Rust 初体验
Rust 给我的第一印象就是：对 Linux 用户十分友好。  
我学习 Rust 是先从环境配置开始，根据 [Rust 中文文档安装指南](https://kaisery.github.io/trpl-zh-cn/ch01-01-installation.html)中所说一步步走，我几乎没遇到什么障碍就完成了环境的配置。为什么说对 Linux 用户十分友好呢。像我这样的 Linux 用户崇尚着“命令行至上”的理念，想在命令行界面上完成所有对计算机的操作而不是 UI 界面，正所谓“一台电脑一把键盘足矣”。而 Rust 的所有环境配置操作都在命令行界面上可以很方便的完成。另外，很明显的是 Rust 在 Unix 端的环境配置比在 Windows 端要方便许多。  
第二印象就是：难。  
曾经有人吐槽过“Rust 反人类”。一开始学习 Rust 的时候，确实会有这样的感受。所有权，生命周期，trait 等概念，确实很令人费解。我觉得这有一部分原因是由于我们对 C/C++ 比较熟悉，这导致了我们在面对 Rust 中与我们编程思维不一致的特性的时候不易理解。另外一部分原因我觉得是因为 Rust 确实门槛比较高，初学者不易入门。但这些都不能掩盖 Rust 发光之处：内存安全和线程安全。所有权避免了内存二次释放，生命周期机制避免了裸指针的出现。  
所有权和生命周期机制在保证了内存安全的同时，也给我们的编程带来了较大的麻烦，安全与效率往往不可兼得，如果在写操作系统或者其他项目的开发过程中完全使用 Rust ，那无疑是一个量十分庞大的工作。为了折中，Rust 语言支持 unsafe 代码，在这部分代码中，编译器选择相信人类的判断。下面来自网友们的一段话十分形象地描述了 Rust 语言这部分的特性：  
> C++ 选择相信人类，它要求人类把自己 new 出来的东西给 delete 掉。
> C++：“这点小事我相信你可以的！“
> 人类：”没问题！包在我身上！“
> 然后内存泄漏，二次释放，野指针满世界飘...
> Java选择不相信人类，它自己替人类把事情办好。
> Java：”别动，让我来，我有 gc ！“
> 人类：”你怎么做事这么慢呀？你怎么还 stop the world 了呀？你是不是不想干了呀？“
> Java：”......“
> Rust 知道唯一的办法就是既不相信人类，也不惯着人类。
> Rust：”按我说的做！不然就不编译！“
> 人类：”你反人类！“
> Rust：”你管我！”
> 

Rust之所以反人类，是因为人类在编程这件事上，既愚蠢又自大，破事还贼多......  
对 Rust 的最后一点印象就是：社区庞大。  
虽然 Rust 社区还在建设中，但数量规模已经相当可观，其中不乏代码能力十分高强的人物，就好像武林世界一样，盘龙卧虎，各路大侠八仙过海，不断完善 Rust 的不足，目的就是为了推翻当前编程语言界的统治势力：C/C++。我国现在 Rust 社区起步较晚，目前还在萌芽状态，我作为一名大二学生，有意推进国内 Rust 社区的进步和发展。  
另外 Rust 语言开发的模块化做得比较优秀。开发者们写的代码作为一个个的 crate ，可以很方便地被调用。  
虽说 Rust 学习成本较高，但也并不是什么洪水猛兽，只要多加练习，还是能逐渐地掌握这门新时代的系统语言的。  
## 初识 RISC-V
对很多人来说 RISC-V 是一个陌生的词，简单来说，这是一个区别于 x86, Arm 的计算机体系架构。  
具体地说，RISC-V 是一个基于精简指令集（RISC）原则的开源指令集架构（ISA）。它起源于2010年加州大学伯克利分校的一个项目，贡献者是许多志愿者和行业工作者。  
可以说我参加这个 OS 实习的最大收获就在这个 RISC-V 体系结构之上。在这之前，我一直局限于 x86 ，Arm 架构之中，RISC-V 给我带来了另一种可能性。  
我学习 RISC-V 首先是看了浙江大学的计算机组成原理课，这个课程是基于 RISC-V 进行授课的。然后看了[RISC-V手册](http://crva.ict.ac.cn/documents/RISC-V-Reader-Chinese-v2p1.pdf)和[RISC-V特权指令级规范](https://riscv.org/specifications/privileged-isa/)，内容挺多的，看了挺久。  
RISC-V 为操作系统提供了三种权限模式：机器模式（machine mode），监管者模式（supervisor mode）和用户模式（user mode）。默认情况下，发生所有异常的时候，控制权都会被移交到机器模式的异常处理程序，但是 Unix 系统中的大多数例外都应该进行监管者模式下的系统调用。机器模式的异常处理程序可以将异常重新导向监管者模式，但是这些额外的操作会减慢大多数异常的处理速度，因此 RISC-V 提供了一种异常委托机制，可以选择性地将中断和同步异常交给监管者模式处理。  
目前国内已经有不少产商或者高校或者研究所开始对 RISC-V CPU 内核进行研发了，据我所知的有国科大，他们正在写一个 RISC-V CPU 的内核，并且打算开源。目前这个领域还是很有潜力的。  
RISC-V 的学习道阻且长，而且现在 RISC-V 还在一直制定标准的过程中，相信将来，RISC-V 会取代当前 x86 的地位，成为新一代 CPU 的首选。  
## 深入 OS
首先谈一下什么是操作系统。  
我的回答是：并没有一个明确的定义。  
然后我的理解是：操作系统是一个软件，这个软件功能比较强大，强大到所有其他的软件都调用它的库或者利用它提供的系统调用服务。打个比方，整个计算机系统就像一个森林，操作系统就是这片森林之下的土壤，而这之上的植物就好比软件，操作系统就为它们提供各种服务。  

## 动手写操作系统
## 感受
